import{r as l,j as t,G as L,c as S,H as U,t as c,I as V,J as _,K as J,L as T}from"./index-ClTdhUSR.js";const k="meet.jit.si";var B=function(n,r,s,o){function p(a){return a instanceof s?a:new s(function(f){f(a)})}return new(s||(s=Promise))(function(a,f){function g(d){try{w(o.next(d))}catch(i){f(i)}}function x(d){try{w(o.throw(d))}catch(i){f(i)}}function w(d){d.done?a(d.value):p(d.value).then(g,x)}w((o=o.apply(n,r||[])).next())})};const W=(n,r,s)=>B(void 0,void 0,void 0,function*(){return new Promise((o,p)=>{if(window.JitsiMeetExternalAPI)return o(window.JitsiMeetExternalAPI);const a=document.createElement("script"),f=r?`?release=${r}`:"",g=s?`${s}/`:"";a.async=!0,a.src=`https://${n}/${g}external_api.js${f}`,a.onload=()=>o(window.JitsiMeetExternalAPI),a.onerror=()=>p(new Error(`Script load error: ${a.src}`)),document.head.appendChild(a)})});let A;const F=(n=k,r,s)=>A||(A=W(n,r,s),A),H=n=>{const r=n.split("/");if(!(r.length<=1))return r[0]};let K=0;const D=n=>`${n}-${K++}`,G=({domain:n=k,roomName:r,configOverwrite:s,interfaceConfigOverwrite:o,jwt:p,invitees:a,devices:f,userInfo:g,release:x,lang:w,spinner:d,onApiReady:i,onReadyToClose:v,getIFrameRef:N})=>{const[M,$]=l.useState(!0),[E,P]=l.useState(!1),C=l.useRef(),h=l.useRef(),y=l.useRef(null),I=l.useMemo(()=>D("jitsiMeeting"),[D]);l.useEffect(()=>{F(n,x,H(r)).then(b=>{C.current=b,P(!0)}).catch(b=>console.error(b.message))},[]);const O=l.useCallback(b=>{h.current=new b(n,{roomName:r,configOverwrite:s,interfaceConfigOverwrite:o,jwt:p,invitees:a,devices:f,userInfo:g,release:x,lang:w,parentNode:y.current}),$(!1),h.current&&(typeof i=="function"&&i(h.current),h.current.on("readyToClose",()=>{typeof v=="function"&&v()}),y.current&&typeof N=="function"&&N(y.current))},[h,y,i,v,N,n,r,s,o,p,a,f,g,x,w]);l.useEffect(()=>{E&&!h.current&&C.current&&O(C.current)},[E,O]);const R=l.useCallback(()=>!d||!M||h.current?null:t.jsx(d,{},void 0),[d,h.current]);return t.jsxs(t.Fragment,{children:[R(),t.jsx("div",{id:I,ref:y},I)]},void 0)};function q({roomName:n,displayName:r,onEnd:s}){return t.jsx("div",{className:"w-full h-[600px] border rounded shadow overflow-hidden",children:t.jsx(G,{domain:"meet.jit.si",roomName:n,configOverwrite:{startWithAudioMuted:!0,startWithVideoMuted:!1},interfaceConfigOverwrite:{TOOLBAR_BUTTONS:["microphone","camera","desktop","fullscreen","fodeviceselection","hangup","chat","raisehand","tileview","videobackgroundblur","download","help"]},userInfo:{displayName:r},onApiReady:o=>{o.addListener("readyToClose",()=>{s&&s()})},getIFrameRef:o=>{o.style.height="100%",o.style.width="100%"}})})}function X({userId:n,userName:r,messages:s,onSendMessage:o,roomId:p=null,onVisitCreated:a=null,showCreateVisit:f=!1}){const[g,x]=l.useState(""),[w,d]=l.useState(!1),[i,v]=l.useState(p),[N,M]=l.useState(s||[]),[$,E]=l.useState(!1);l.useEffect(()=>{i?P():M(s||[])},[i,s]);const P=()=>{if(i){const e=L(i);M(e)}else if(n){const e=S();if(e){const u=U(e.id,n);M(u)}}},C=()=>{if(!g.trim())return;const e=S(),u=V();if(!e){alert("Please log in to send messages");return}let j;if(i){const m={roomId:i,senderId:e.id,senderName:e.name,senderRole:u,text:g.trim(),timestamp:new Date().toISOString()};j=_(m)}else j=J(e.id,n,g.trim(),u);M(m=>[...m,j]),o&&o(j),x("")},h=()=>{if(f){E(!0);try{const e=S(),u=V();if(!e){alert("Please log in to create a visit");return}const j={patientId:n,patientName:r,doctorId:u==="doctor"?e.id:null,ashaId:u==="asha"?e.id:null,type:"consultation",status:"waiting",priority:"normal",symptoms:[],notes:"Visit created from message section"},m=T(j);v(m.roomId),a&&a(m),alert("Visit created successfully! A doctor will attend to you shortly.")}catch(e){console.error("Error creating visit:",e),alert("Failed to create visit. Please try again.")}finally{E(!1)}}},y=()=>{i||v(`room-${n}-${Date.now()}`),d(!0)},I=()=>{d(!1)},O=e=>{if(!e)return"";const u=new Date(e),m=Math.floor((new Date-u)/(1e3*60));return m<1?c("Just now"):m<60?`${m} ${c("min ago")}`:m<1440?`${Math.floor(m/60)} ${c("hr ago")}`:u.toLocaleDateString()},R=e=>{if(e.senderName)return e.senderName;switch(e.senderRole){case"doctor":return c("Doctor");case"asha":return c("ASHA Worker");case"pharmacy":return c("Pharmacy");default:return c("User")}},b=e=>{const u=S();if(u&&e.senderId===u.id)return"bg-blue-500 text-white";switch(e.senderRole){case"doctor":return"bg-green-500 text-white";case"asha":return"bg-purple-500 text-white";case"pharmacy":return"bg-yellow-500 text-white";default:return"bg-gray-500 text-white"}};return t.jsxs("section",{className:"bg-white p-6 rounded-lg shadow-md",children:[t.jsxs("div",{className:"flex items-center justify-between mb-4",children:[t.jsx("h2",{className:"text-lg font-semibold text-gray-800",children:c("Messages & Video Call")}),f&&!i&&t.jsx("button",{onClick:h,disabled:$,className:"px-4 py-2 bg-green-600 text-white text-sm rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:$?c("Creating..."):c("Create Visit")})]}),t.jsx("div",{className:"bg-gray-50 rounded-lg p-4 mb-4 max-h-60 overflow-y-auto",children:N.length===0?t.jsx("p",{className:"text-gray-500 text-center py-4",children:c("No messages yet. Start a conversation!")}):t.jsx("div",{className:"space-y-3",children:N.map(e=>t.jsx("div",{className:`flex ${e.senderId===S()?.id?"justify-end":"justify-start"}`,children:t.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${b(e)}`,children:[t.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[t.jsx("span",{className:"text-xs font-medium",children:R(e)}),t.jsx("span",{className:"text-xs opacity-75",children:O(e.timestamp)})]}),t.jsx("p",{className:"text-sm",children:e.text})]})},e.id))})}),t.jsxs("div",{className:"flex gap-2 mb-4",children:[t.jsx("input",{type:"text",className:"flex-1 border border-gray-300 px-3 py-2 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",value:g,onChange:e=>x(e.target.value),onKeyPress:e=>{e.key==="Enter"&&C()},placeholder:c("Type your message...")}),t.jsx("button",{className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition-colors",onClick:C,children:c("Send")})]}),w?t.jsxs("div",{className:"mt-4",children:[t.jsxs("div",{className:"bg-gray-100 p-4 rounded-lg mb-3",children:[t.jsxs("h3",{className:"text-sm font-medium text-gray-700 mb-2",children:[c("Video Call with")," ",r]}),t.jsxs("p",{className:"text-xs text-gray-500",children:[c("Room ID"),": ",i]})]}),t.jsx(q,{roomName:i,displayName:S()?.name||r,onEnd:I}),t.jsx("button",{className:"mt-3 w-full bg-red-600 text-white px-4 py-2 rounded-md shadow hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 focus:ring-offset-2 transition-colors",onClick:I,children:c("End Call")})]}):t.jsxs("button",{className:"w-full bg-green-600 text-white px-4 py-2 rounded-md shadow hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-2 transition-colors",onClick:y,children:["ðŸ“¹ ",c("Start Video Call")]})]})}export{q as J,X as M};
