import{u as S,r as a,j as e,t as r,z as O,s as T}from"./index-ClTdhUSR.js";import{s as A,v as L}from"./otpService-D1Q3AacJ.js";function E(){const p=S(),[c,h]=a.useState("password"),[n,x]=a.useState(""),[m,w]=a.useState(""),[u,v]=a.useState(""),[l,i]=a.useState(!1),[y,s]=a.useState(""),[g,d]=a.useState(""),j=async t=>{if(t.preventDefault(),!n.trim()){s("Phone number is required");return}if(!m.trim()){s("Password is required");return}i(!0),s(""),d("");try{const o=O(n,m);o.success?(d("Login successful!"),setTimeout(()=>{p("/asha/dashboard")},1e3)):s(o.error||"Invalid credentials")}catch(o){s("An error occurred while logging in"),console.error("Login error:",o)}finally{i(!1)}},N=async()=>{if(!n.trim()){s("Phone number is required");return}i(!0),s(""),d("");try{const t=A(n,"login");t.success?d("OTP sent successfully!"):s(t.error||"Failed to send OTP")}catch(t){s("An error occurred while sending OTP"),console.error("OTP send error:",t)}finally{i(!1)}},P=async t=>{if(t.preventDefault(),!n.trim()){s("Phone number is required");return}if(!u.trim()){s("OTP is required");return}if(u.length!==6){s("OTP must be 6 digits");return}i(!0),s(""),d("");try{const o=L(n,u,"login");if(o.success){const f=JSON.parse(localStorage.getItem("ashas")||"[]").find(b=>b.phone===n);if(f){const b={current:{role:"asha",id:f.id,name:f.name,loggedAt:new Date().toISOString()}};T(b),d("Login successful!"),setTimeout(()=>{p("/asha/dashboard")},1e3)}else s("ASHA worker not found. Please sign up first.")}else s(o.error||"Invalid OTP")}catch(o){s("An error occurred while verifying OTP"),console.error("OTP verify error:",o)}finally{i(!1)}};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-b from-purple-50 to-purple-100 font-sans",children:[e.jsx("main",{className:"flex-grow flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white p-8 rounded-2xl shadow-xl w-full max-w-md border border-purple-100",children:[e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:r("ASHA Login")}),e.jsx("p",{className:"text-gray-600",children:r("Access your ASHA dashboard")})]}),g&&e.jsx("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-md",children:e.jsx("p",{className:"text-sm text-green-800",children:g})}),y&&e.jsx("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-md",children:e.jsx("p",{className:"text-sm text-red-800",children:y})}),e.jsxs("div",{className:"flex mb-6 space-x-4",children:[e.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg font-medium transition ${c==="password"?"bg-purple-600 text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>h("password"),children:r("Password")}),e.jsx("button",{className:`flex-1 px-4 py-2 rounded-lg font-medium transition ${c==="otp"?"bg-purple-600 text-white shadow":"bg-gray-200 text-gray-700 hover:bg-gray-300"}`,onClick:()=>h("otp"),children:r("OTP")})]}),c==="password"&&e.jsxs("form",{onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("Mobile Number")," *"]}),e.jsx("input",{type:"tel",value:n,onChange:t=>x(t.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:r("Enter mobile number")})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("Password")," *"]}),e.jsx("input",{type:"password",value:m,onChange:t=>w(t.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:r("Enter password")})]}),e.jsx("button",{type:"submit",disabled:l,className:"w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?r("Logging in..."):r("Login")})]}),c==="otp"&&e.jsxs("form",{onSubmit:P,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("Mobile Number")," *"]}),e.jsx("input",{type:"tel",value:n,onChange:t=>x(t.target.value),required:!0,className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent",placeholder:r("Enter mobile number")})]}),e.jsx("button",{type:"button",onClick:N,disabled:l||!n.trim(),className:"w-full bg-yellow-500 text-white py-2 rounded-lg hover:bg-yellow-600 focus:outline-none focus:ring-2 focus:ring-yellow-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?r("Sending..."):r("Send OTP")}),g&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:[r("Enter OTP")," *"]}),e.jsx("input",{type:"text",value:u,onChange:t=>v(t.target.value.replace(/\D/g,"").slice(0,6)),required:!0,maxLength:"6",className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent text-center text-lg tracking-widest",placeholder:"000000"})]}),g&&e.jsx("button",{type:"submit",disabled:l,className:"w-full bg-purple-600 text-white py-2 rounded-lg hover:bg-purple-700 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:l?r("Verifying..."):r("Verify OTP")})]}),e.jsxs("p",{className:"text-sm text-gray-600 mt-6 text-center",children:[r("Don't have an account?")," ",e.jsx("button",{onClick:()=>p("/asha/signup"),className:"text-purple-700 font-semibold hover:underline",children:r("Sign up")})]})]})}),e.jsxs("footer",{className:"bg-purple-700 text-white py-4 text-center text-sm mt-8 shadow-inner",children:["Â© ",new Date().getFullYear()," ",r("E-Sannidhi")," | ",r("Government of India Initiative")]})]})}export{E as default};
